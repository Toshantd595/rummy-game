<!-- Firebase SDKs -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
<script>
  // Firebase config
  const firebaseConfig = {
    apiKey: "AIzaSyC1D45vfziD-wqIrDGANAY7GzR0L94BqB8",
    authDomain: "rummy-multiplayer-fe391.firebaseapp.com",
    databaseURL: "https://rummy-multiplayer-fe391-default-rtdb.asia-southeast1.firebasedatabase.app",
    projectId: "rummy-multiplayer-fe391",
    storageBucket: "rummy-multiplayer-fe391.appspot.com",
    messagingSenderId: "717212591323",
    appId: "1:717212591323:web:7cb38b16733f7a9b5498fe"
  };

  // Initialize Firebase
  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

  let roomId = '';
  let username = '';
  let playerId = '';

  function createRoom() {
    username = prompt("Enter your name:");
    if (!username) return;

    roomId = Math.random().toString(36).substring(2, 8).toUpperCase();
    playerId = `player_${Date.now()}`;

    db.ref(`rooms/${roomId}`).set({
      status: 'waiting',
      players: {
        [playerId]: { username }
      }
    });

    enterGame();
  }

  function joinRoom() {
    username = prompt("Enter your name:");
    if (!username) return;

    roomId = prompt("Enter room code:");
    if (!roomId) return;

    playerId = `player_${Date.now()}`;
    const playerRef = db.ref(`rooms/${roomId}/players/${playerId}`);
    playerRef.set({ username })
      .then(() => {
        enterGame();
      })
      .catch((error) => {
        alert("Room not found or could not join.");
        console.error(error);
      });
  }

  function enterGame() {
    document.getElementById('displayRoomCode').textContent = roomId;
    document.getElementById('gameContainer').style.display = 'block';
    document.getElementById('createRoomBtn').style.display = 'none';
    document.getElementById('joinRoomBtn').style.display = 'none';

    listenForPlayers();
    listenForMessages();
  }

  function listenForPlayers() {
    db.ref(`rooms/${roomId}/players`).on('value', (snapshot) => {
      const players = snapshot.val();
      const playerList = document.getElementById('playerList');
      playerList.innerHTML = '';

      for (const key in players) {
        const player = players[key];
        const div = document.createElement('div');
        div.className = 'player-item';
        div.innerHTML = `<div class="player-name">${player.username}</div>`;
        playerList.appendChild(div);
      }
    });
  }

  function sendMessage() {
    const message = document.getElementById('chatInput').value.trim();
    if (!message) return;

    const chatRef = db.ref(`rooms/${roomId}/chat`).push();
    chatRef.set({
      sender: username,
      message,
      timestamp: Date.now()
    });
    document.getElementById('chatInput').value = '';
  }

  function listenForMessages() {
    const chatRef = db.ref(`rooms/${roomId}/chat`);
    chatRef.on('child_added', (snapshot) => {
      const data = snapshot.val();
      addChatMessage(data.sender, data.message);
    });
  }

  function addChatMessage(sender, message) {
    const chatBox = document.getElementById('chatMessages');
    const div = document.createElement('div');
    div.className = 'chat-message';
    div.innerHTML = `<strong>${sender}:</strong> ${message}`;
    chatBox.appendChild(div);
    chatBox.scrollTop = chatBox.scrollHeight;
  }
</script>
