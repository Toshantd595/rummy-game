<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Love Rummy</title>
  <meta name="description" content="Multiplayer Rummy Game with Love Theme" />

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

  <!-- React + Babel -->
  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script>
    Babel.registerPreset("react", {
      presets: [Babel.availablePresets["react"]],
    });
  </script>

  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            rose: { 500: "#f43f5e", 700: "#be123c" },
            pink: { 500: "#ec4899", 600: "#db2777" },
          },
        },
      },
    };
  </script>

  <style>
    body {
      background: linear-gradient(to bottom right, #fdf2f8, #fce7f3, #fbcfe8);
      font-family: 'Segoe UI', sans-serif;
    }
    .love-gradient {
      background: linear-gradient(to right, #f472b6, #fb7185, #f472b6);
    }
    .card {
      width: 40px;
      height: 60px;
      border-radius: 6px;
      text-align: center;
      padding-top: 12px;
      font-size: 18px;
      font-weight: bold;
      background-color: white;
      border: 2px solid #fb7185;
      margin: 2px;
      box-shadow: 1px 1px 4px rgba(0,0,0,0.2);
    }
    .selected {
      transform: translateY(-10px);
      border-color: #db2777;
    }
    .red-suit {
      color: #e11d48;
    }
  </style>
</head>
<body>
  <div id="root"></div>
  <script type="text/babel" data-presets="react">
    const { useState, useEffect } = React;

    const firebaseConfig = {
      apiKey: "AIzaSyC1D45vfziD-wqIrDGANAY7GzR0L94BqB8",
      authDomain: "rummy-multiplayer-fe391.firebaseapp.com",
      databaseURL: "https://rummy-multiplayer-fe391-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "rummy-multiplayer-fe391",
      storageBucket: "rummy-multiplayer-fe391.appspot.com",
      messagingSenderId: "717212591323",
      appId: "1:717212591323:web:7cb38b16733f7a9b5498fe"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    function generateDeck() {
      const suits = ["â™ ", "â™¥", "â™¦", "â™£"];
      const values = ["A", "2", "3", "4", "5", "6", "7", "8", "9", "10", "J", "Q", "K"];
      const deck = [];
      for (let suit of suits) {
        for (let value of values) {
          deck.push(value + suit);
        }
      }
      return deck.sort(() => Math.random() - 0.5);
    }

    function Card({ card, selected, toggle }) {
      const suit = card.slice(-1);
      const value = card.slice(0, -1);
      const isRed = suit === "â™¥" || suit === "â™¦";
      return (
        <div onClick={toggle} className={`card ${selected ? "selected" : ""} ${isRed ? "red-suit" : ""}`}>{value + suit}</div>
      );
    }

    function App() {
      const [room, setRoom] = useState(null);
      const [playerId, setPlayerId] = useState("");
      const [players, setPlayers] = useState([]);
      const [hand, setHand] = useState([]);
      const [selected, setSelected] = useState([]);
      const [turn, setTurn] = useState(null);
      const [message, setMessage] = useState("");
      const [winner, setWinner] = useState(null);

      useEffect(() => {
        const hash = window.location.hash.slice(1);
        if (!hash) return;
        setRoom(hash);

        const ref = db.ref(`rooms/${hash}`);
        ref.once("value", snap => {
          let data = snap.val();
          if (!data || !data.players || data.players.length >= 2) return;

          let newPlayer = data.players.length === 0 ? "player1" : "player2";
          setPlayerId(newPlayer);
          ref.child("players").set([...data.players, newPlayer]);
          ref.child(`hands/${newPlayer}`).on("value", snap => {
            if (snap.exists()) setHand(snap.val());
          });
        });

        db.ref(`rooms/${hash}/turn`).on("value", snap => {
          if (snap.exists()) setTurn(snap.val());
        });

        db.ref(`rooms/${hash}/winner`).on("value", snap => {
          if (snap.exists()) setWinner(snap.val());
        });
      }, []);

      function createRoom() {
        const code = Math.random().toString(36).substring(2, 8).toUpperCase();
        const deck = generateDeck();
        const hands = {
          player1: deck.slice(0, 13),
          player2: deck.slice(13, 26)
        };
        db.ref(`rooms/${code}`).set({
          deck: deck.slice(26),
          players: [],
          hands,
          turn: "player1",
          winner: null
        });
        window.location.hash = code;
        window.location.reload();
      }

      function drawCard() {
        if (turn !== playerId) return;
        const deckRef = db.ref(`rooms/${room}/deck`);
        deckRef.once("value", snap => {
          const deck = snap.val() || [];
          if (deck.length === 0) return;
          const drawn = deck.pop();
          db.ref(`rooms/${room}/deck`).set(deck);
          const newHand = [...hand, drawn];
          db.ref(`rooms/${room}/hands/${playerId}`).set(newHand);
        });
      }

      function discardCard(card) {
        if (turn !== playerId || !card) return;
        const newHand = hand.filter(c => c !== card);
        db.ref(`rooms/${room}/hands/${playerId}`).set(newHand);
        const nextPlayer = playerId === "player1" ? "player2" : "player1";
        db.ref(`rooms/${room}/turn`).set(nextPlayer);
        setSelected([]);
      }

      function resetGame() {
        if (!room) return;
        createRoom();
      }

      return (
        <div className="p-4 text-center">
          <h1 className="text-3xl font-bold love-gradient text-transparent bg-clip-text mb-4">ðŸ’– Love Rummy</h1>

          {!room && (
            <>
              <button onClick={createRoom} className="bg-pink-500 text-white px-6 py-3 rounded-lg shadow m-2">Create Room</button>
              <button onClick={() => {
                const joinCode = prompt("Enter Room Code");
                if (joinCode) {
                  window.location.hash = joinCode.toUpperCase();
                  window.location.reload();
                }
              }} className="bg-rose-500 text-white px-6 py-3 rounded-lg shadow m-2">Join Room</button>
            </>
          )}

          {room && (
            <>
              <h2 className="text-lg text-pink-700">Room: {room}</h2>
              {winner ? (
                <h3 className="text-green-600 font-semibold mt-2">ðŸŽ‰ {winner} wins!</h3>
              ) : (
                <h3 className="mb-2 text-rose-500">{turn === playerId ? "ðŸŽ¯ Your Turn" : "Waiting..."}</h3>
              )}

              <div className="flex flex-wrap justify-center mb-4">
                {hand.map(card => (
                  <Card
                    key={card}
                    card={card}
                    selected={selected.includes(card)}
                    toggle={() =>
                      setSelected(prev =>
                        prev.includes(card) ? prev.filter(c => c !== card) : [...prev, card]
                      )
                    }
                  />
                ))}
              </div>

              <div className="flex justify-center gap-2">
                <button onClick={drawCard} className="bg-purple-500 text-white px-4 py-2 rounded">Draw</button>
                <button onClick={() => discardCard(selected[0])} className="bg-rose-500 text-white px-4 py-2 rounded">Discard</button>
                <button onClick={resetGame} className="bg-gray-500 text-white px-4 py-2 rounded">Restart</button>
              </div>

              <p className="mt-4 text-pink-600">{message}</p>
            </>
          )}
        </div>
      );
    }

    ReactDOM.render(<App />, document.getElementById("root"));
  </script>
</body>
</html>
